{% extends "base.html" %}

{% block content %}
<h1>Баланс: {{ balance }}</h1>
<h3>Доходы: {{ total_income }}</h3>
<h3>Расходы: {{ total_expense }}</h3>

{% if filter_description %}
<div class="alert alert-info">
    <strong>Активные фильтры:</strong> {{ filter_description }}
</div>
{% endif %}

<div class="card mb-4">
    <div class="card-header">
        <h5 class="mb-0">Фильтры</h5>
    </div>
    <div class="card-body">
        <form method="get" action="">
            {{ form.hidden_tag() }}
            
            <div class="row mb-3">
                <div class="col-md-4">
                    {{ form.period.label(class="form-label") }}
                    {{ form.period(class="form-select form-control") }}
                </div>
                
                <div class="col-md-4">
                    {{ form.category_id.label(class="form-label") }}
                    {{ form.category_id(class="form-select form-control") }}
                </div>
                
                <div class="col-md-4">
                    {{ form.transaction_type.label(class="form-label") }}
                    {{ form.transaction_type(class="form-select form-control") }}
                </div>
            </div>
            
            <button type="submit" name="apply_filter" class="btn btn-primary">Применить</button>
            <a href="{{ url_for('transactions.transaction_main') }}" class="btn btn-secondary">Сбросить</a>
        </form>
    </div>
</div>

{% if transactions %}
<div class="list-group">
    {% for transaction in transactions %}
    <div class="list-group-item">
        <div class="d-flex w-100 justify-content-between">
            <h5 class="mb-1">{{ transaction.category.name }}</h5>
            <small>{{ transaction.date.strftime('%d.%m.%Y') }}</small>
        </div>
        
        <p class="mb-1">
            <a href="{{ url_for('transactions.view_transaction', transaction_id=transaction.id) }}">
                {{ transaction.amount }}
            </a>
            - {{ transaction.description }}
        </p>
        
        <small class="badge {% if transaction.type == 'income' %}bg-success{% else %}bg-danger{% endif %}">
            {{ 'Доход' if transaction.type == 'income' else 'Расход' }}
        </small>
        
        {% if transaction.image_filename %}
        <div class="mt-2">
            <img src="{{ url_for('static', filename='uploads/transactions/' + transaction.image_filename) }}" 
                 alt="Чек" 
                 class="img-thumbnail" 
                 style="max-width: 100px; max-height: 100px;">
            <small class="text-muted">Прикреплен чек</small>
        </div>
        {% endif %}
        
        <div class="mt-2">
            <a href="{{ url_for('transactions.edit_transaction', transaction_id=transaction.id) }}" class="btn btn-sm btn-outline-primary">Изменить</a>
            <a href="{{ url_for('transactions.delete_transaction', transaction_id=transaction.id) }}" class="btn btn-sm btn-outline-danger">Удалить</a>
        </div>
    </div>
    {% endfor %}
</div>
{% else %}
<div class="text-center py-5">
    <h2>Нет транзакций</h2>
    <a href="{{ url_for('transactions.add_transaction') }}" class="btn btn-primary">Создать первую транзакцию</a>
</div>
{% endif %}

<style>
.form-select {
    padding: 8px 12px;
    border-radius: 5px;
    border: 1px solid #ced4da;
}

.form-select option {
    padding: 8px;
    background: white;
    border: none;
}
</style>
{% endblock %}